<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Ethereum J]]></title>
  <link href="http://ethereumj.io/atom.xml" rel="self"/>
  <link href="http://ethereumj.io/"/>
  <updated>2015-08-03T15:05:23-04:00</updated>
  <id>http://ethereumj.io/</id>
  <author>
    <name><![CDATA[Roman Mandeleil]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Release: 1.0.0-RC1]]></title>
    <link href="http://ethereumj.io/blog/2015/07/29/release-1-0-0-RC1/"/>
    <updated>2015-07-29T17:03:57-04:00</updated>
    <id>http://ethereumj.io/blog/2015/07/29/release-1-0-0-RC1</id>
    <content type="html"><![CDATA[<p><img class="right" src="http://ethereumj.io/images/posts/release-ilustration-1.gif" title="Release 1.0.0-RC1" ></p>

<p>That version is first of the RC series for Frontier network.</p>

<p> Ethereum(J) is the library that can be embedded in any Java/Scala project
 and to provide full support for Ethereum protocol and sub services.</p>

<h5>Getting Started</h5>

<p>To get started and include a java library into your project all you need is
to <!--more--> use your favorite build system, here is Maven and Gradlle snippet:</p>

<figure class='code'><figcaption><span>Maven Snippet</span><a href='https://gist.github.com/romanman/659e9e5b6b44b73b5755'>link</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'>
</span><span class='line'>   <span class="nt">&lt;repositories&gt;</span>
</span><span class='line'>     <span class="nt">&lt;repository&gt;</span>
</span><span class='line'>       <span class="nt">&lt;id&gt;</span>oss.jfrog.org<span class="nt">&lt;/id&gt;</span>
</span><span class='line'>       <span class="nt">&lt;name&gt;</span>Repository from JFrog<span class="nt">&lt;/name&gt;</span>
</span><span class='line'>       <span class="nt">&lt;url&gt;</span>http://oss.jfrog.org/simple/oss-snapshot-local/<span class="nt">&lt;/url&gt;</span>
</span><span class='line'>     <span class="nt">&lt;/repository&gt;</span>
</span><span class='line'>   <span class="nt">&lt;/repositories&gt;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>   <span class="nt">&lt;dependency&gt;</span>
</span><span class='line'>     <span class="nt">&lt;groupId&gt;</span>org.ethereum<span class="nt">&lt;/groupId&gt;</span>
</span><span class='line'>     <span class="nt">&lt;artifactId&gt;</span>ethereumj-core<span class="nt">&lt;/artifactId&gt;</span>
</span><span class='line'>     <span class="nt">&lt;version&gt;</span> 1.0.0-RC1 <span class="nt">&lt;/version&gt;</span>
</span><span class='line'>     <span class="nt">&lt;type&gt;</span>zip<span class="nt">&lt;/type&gt;</span>
</span><span class='line'>   <span class="nt">&lt;/dependency&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>or</p>

<figure class='code'><figcaption><span>Gradle Snippet</span><a href='https://gist.github.com/romanman/cc82a7a698f800040e10'>link</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'>   <span class="n">repositories</span> <span class="o">{</span>
</span><span class='line'>     <span class="n">maven</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">url</span> <span class="s2">&quot;https://oss.jfrog.org/libs-snapshot&quot;</span>
</span><span class='line'>     <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>   <span class="n">compile</span> <span class="o">(</span><span class="s2">&quot;org.ethereum:ethereumj-core:1.0.0-RC1&quot;</span><span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p> Also we have very simple starter example
 just do:
 <code>git clone https://github.com/ether-camp/ethereumj.starter</code>
   and you are ready to develop your first Ethereum application.</p>

<p>  Also it can be usefull to browse the code and study how ethereumj
  library is weaved into the application:</p>

<p>  <a href="https://github.com/ether-camp/ethereumj.starter">https://github.com/ether-camp/ethereumj.starter</a></p>

<p> <em>So, what is in:</em></p>

<h5>RLPx network layer for channel protection</h5>

<p> Between each connected peers on the Ethereum network
 there is a protection mechanism for encryption and decryption
 for all of the underlying traffic.</p>

<p> <code>org.ethereum.net.rlpx</code> - package is full implementation for the RLPx protocol</p>

<h5>Peer Discovery</h5>

<p> The peer discovery is ethereum way to manage network topology. Each peer
 tries over time to find best neighbours to exchange information with.
 That is beeing achieved by managing statistic table over the connected peers.</p>

<p> <code>org.ethereum.net.rlpx.discover</code> - is full implementation for peer disovery protocol</p>

<h5>Multi Peer Blockchain Syncronization</h5>

<p> The Ethereum protocol supports fast block chain download - using
 bittorent way of downloading multiple blocks simultaneously from different channels</p>

<p> <code>org.ethereum.net.eth</code> - us full support of Eth subprotocol and multipeer blocks download</p>

<h5>Full Ethereum VM Support</h5>

<p> The heart of the Ethereum consensus protocol is the virtual machine.
 The virtual machines is running the contracts algorithms exactly the
 same way on all the peers, tested and compatible with all implementations.</p>

<p> <code>org.ethereum.vm</code> - full Ethereum Virtual Machine implemented]</p>

<h5>Ethereum Repository Updates and Manipulations</h5>

<p> The data structure that supports consensys validation
 algorithm, and eventually holding the full list of
 ethereum affairs is called Ethereum Repository.
 It embrace Ethereum Trie protocol, more can be
 study <a href="http://ethereumj.io/blog/2015/07/05/Ethereum-Trie/">here</a></p>

<p> <code>org.ethereum.repository</code> - full Ethereum Virtual Machine implemented</p>

<h5>Testing Notes</h5>

<p> The EthereumJ librarey Was tested on more than 800k blocks from POC-9 Olympics network and more than 7 million transactions, with final result of full consensus achieved.</p>

<p> The library supports 99% of compatabiltiy kit test case. We support almost all test cases defined by
 Ethereum development group, the several adge cases that we formally not support we decided to exclude
 at that stage for performance optimization.</p>

<h5>More Code Samples</h5>

<p> Another good place get started is to go and try code samples from our smples repository  <a href="https://github.com/ethereum/ethereumj/tree/develop/ethereumj-core/src/main/java/org/ethereum/samples">repository</a>
 you can run them right away after fetching them from the git.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Climbing Ethereum Trie]]></title>
    <link href="http://ethereumj.io/blog/2015/07/05/Ethereum-Trie/"/>
    <updated>2015-07-05T17:03:57-04:00</updated>
    <id>http://ethereumj.io/blog/2015/07/05/Ethereum-Trie</id>
    <content type="html"><![CDATA[<p><img class="center" src="http://ethereumj.io/images/posts/trie-ilustration-1.jpg" title="Trie Headline" ></p>

<p>The Ethereum data structure which is used to calculate the state of all the current balances, all the contract code and even the storage which is occupied by a particular contract, is still difficult for some developers on the project. I actually found myself having a hard time trying to understand it. This is why I will try to make a clear and visual explanation of the simple concepts and ideas that stand behind this important structure.</p>

<!--more-->


<p><strong>Why do we need it?</strong></p>

<p>Before designing and using a new data structure, it’s always good to start by asking: “Why?” or more specifically, “What are the main requirements that we need so bad, that we are designing a new data structure?”</p>

<p>In our case we have three:</p>

<ol>
<li>We need a storage efficient hash map.</li>
<li>We need a very time efficient insert/delete hash map.</li>
<li>Most important: We need a fingerprint to identify the state of the whole structure. The fingerprint should be calculated very fast on the fly, obviously depended on all the changes the hash map going to have.</li>
</ol>


<p>So with the requirements defined, let’s see how the structure is built and why it is appropriate for our goals.</p>

<p><strong>1. How is the structure built?</strong></p>

<p>The structure will be a tree, which will be built on a principle of what is known as a Radix Tree, the Radix Tree principle can be explained simply as:</p>

<p>Given a key/value that should be inserted, the key will be split to it’s sub parts e.g. characters and each value will be a node in a tree, so if we want to retrieve the reference value we should jump from node to node each representing part of the key until we find the end and there we will have the value.</p>

<p>In our case we will split the key to a nibbles of it’s ASCII code, don’t worry the example will make it clear:</p>

<p>Let’s take a <code>“dog”</code> string as a key , in order to get it’s nibbles, will check the ASCII code which is <code>[ 0x64 0x6f 0x67 ]</code>, now the nibbles of the key are 4 bits of each byte: <code>6, 4, 6, f, 6, 7</code>.</p>

<p>Another example will be the key: “do” which obviously will be encoded to <code>6, 4, 6, f</code>. (“dog” with no “g”).</p>

<p>Now let’s see how we encode the key value <code>[“do” : “verb”]</code> and <code>[“dog” : “puppy”]</code> into a data structure: (Diagram - 1)</p>

<p><img class="center" src="http://ethereumj.io/images/posts/trie-post-diagram-1.png" title="Diagram-1" ></p>

<p>As we can see each node on the digaram has 17 elements which are representing slots for <code>[ 0..f ]</code> digits of encoding, and one more slot  - the last one, for the value (if it exist).</p>

<p>Now we see that to follow key: <code>“dog”</code> <code>(64 6f 67)</code> we simply follow the slot 6 in the first node, slot 4 in the second, slot 6 on the third, and so on until we bumped into a node that has a 17 slot  filled with value. Here we go <code>“dog”</code> leads as to <code>“puppy”</code> and the key: <code>“do”</code> stops two nibbles before <code>“dog”</code> and we found that the corresponding value is: <code>“verb”</code>.</p>

<p>That concludes the first step of making a Radix Tree in a new, hex slot oriented style.</p>

<p>So what do we get out of this complex structure? The answer is 2 things:</p>

<p>the keys with similar data will be saved economizing common prefixes.
the retrieve/insert of a value is about to be <code>O(log(n))</code> which is not bad at all.
 So far so good, can we improve it ?</p>

<ol>
<li><strong>How to improve it?</strong> : The next question is: how we can improve the structure to be more storage effective ? to answer that we define a rule that can be explained in simple words like that: given “too long path” for a single value , we can make a single node holding the full path as long as it has this only one value. As always example is the best to see it:</li>
</ol>


<p>Starting with the last diagram, let’s insert another key/value: [“doggiestan” : “aeswome_place”]. As we can see the key – “doggiestan” starts with “dog” (looks familiar?) and goes on with more characters. So in that case we are not going to encode the suffix “giestan” as a bunch of nodes but as a single key/value node: (Diagram - 2)</p>

<p><img class="center" src="http://ethereumj.io/images/posts/trie-post-diagram-2.png" title="Diagram-2" ></p>

<p><strong>3. How to encode the finger print? :  </strong></p>

<p>The fingerprint will be the sha3(root_node) function. One will probably ask: “Why it is unique?” or “Why does every change in the trie affect the root node?”  To answer that let’s closely observe the next diagram:</p>

<p><img class="center" src="http://ethereumj.io/images/posts/trie-post-diagram-3.png" title="Diagram-3" ></p>

<p>In previous diagrams we used arrows to point out a node reference by another node, but in the data world, no arrows exist. So how is the reference actually implemented? Simply by saving the hash of the next node, in our case using <code>sha3()</code> function. That way, the most important goal of reflecting a change in data of each node, is achieved. Each change to a node will be reflected in the hash of that node, hence reflecting in the parent, and also his parent, and so on up to the root_node. That’s why <code>sha3(root_node)</code> is the absolute fingerprint of the full structure.</p>

<p><strong>Summary:</strong>  Obviously the Trie structure as it is fully implemented holds more nuances and improvements. But once one understands the 3 principles that I have visualised here, it should be really easy to complete the picture by studying the actual code.</p>

<p>For futher investigation of the wonders of Trie , you can use our repository test cases, one I inserted especially for this post:</p>

<p>That is the runnig example for our test suite and can be used as start point for further study.</p>

<figure class='code'><figcaption><span>Code example</span><a href='https://github.com/ethereum/ethereumj/blob/develop/ethereumj-core/src/test/java/org/ethereum/trie/TrieTest.java#L917'>link</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'>    <span class="nd">@Test</span> <span class="c1">// update the trie with blog key/val</span>
</span><span class='line'>          <span class="c1">// each time dump the entire trie</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testSample_1</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">TrieImpl</span> <span class="n">trie</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">TrieImpl</span><span class="o">(</span><span class="n">mockDb</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">trie</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="s">&quot;dog&quot;</span><span class="o">,</span> <span class="s">&quot;puppy&quot;</span><span class="o">);</span>
</span><span class='line'>        <span class="n">String</span> <span class="n">dmp</span> <span class="o">=</span> <span class="n">trie</span><span class="o">.</span><span class="na">getTrieDump</span><span class="o">();</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">dmp</span><span class="o">);</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span>
</span><span class='line'>        <span class="n">Assert</span><span class="o">.</span><span class="na">assertEquals</span><span class="o">(</span>
</span><span class='line'>          <span class="s">&quot;ed6e08740e4a267eca9d4740f71f573e9aabbcc739b16a2fa6c1baed5ec21278&quot;</span><span class="o">,</span>
</span><span class='line'>          <span class="n">Hex</span><span class="o">.</span><span class="na">toHexString</span><span class="o">(</span><span class="n">trie</span><span class="o">.</span><span class="na">getRootHash</span><span class="o">()));</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">trie</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="s">&quot;do&quot;</span><span class="o">,</span> <span class="s">&quot;verb&quot;</span><span class="o">);</span>
</span><span class='line'>        <span class="n">dmp</span> <span class="o">=</span> <span class="n">trie</span><span class="o">.</span><span class="na">getTrieDump</span><span class="o">();</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">dmp</span><span class="o">);</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span>
</span><span class='line'>        <span class="n">Assert</span><span class="o">.</span><span class="na">assertEquals</span><span class="o">(</span>
</span><span class='line'>          <span class="s">&quot;779db3986dd4f38416bfde49750ef7b13c6ecb3e2221620bcad9267e94604d36&quot;</span><span class="o">,</span>
</span><span class='line'>          <span class="n">Hex</span><span class="o">.</span><span class="na">toHexString</span><span class="o">(</span><span class="n">trie</span><span class="o">.</span><span class="na">getRootHash</span><span class="o">()));</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">trie</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="s">&quot;doggiestan&quot;</span><span class="o">,</span> <span class="s">&quot;aeswome_place&quot;</span><span class="o">);</span>
</span><span class='line'>        <span class="n">dmp</span> <span class="o">=</span> <span class="n">trie</span><span class="o">.</span><span class="na">getTrieDump</span><span class="o">();</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">dmp</span><span class="o">);</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span>
</span><span class='line'>        <span class="n">Assert</span><span class="o">.</span><span class="na">assertEquals</span><span class="o">(</span>
</span><span class='line'>          <span class="s">&quot;8bd5544747b4c44d1274aa99a6293065fe319b3230e800203317e4c75a770099&quot;</span><span class="o">,</span>
</span><span class='line'>          <span class="n">Hex</span><span class="o">.</span><span class="na">toHexString</span><span class="o">(</span><span class="n">trie</span><span class="o">.</span><span class="na">getRootHash</span><span class="o">()));</span>
</span><span class='line'>    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Any questions or comments are welcome.</p>

<p>Thanks to: <strong>Nick Savers</strong> for reviewing the draft and making my language to a real English.</p>

<ul>
<li>by <strong>Roman Mandeleil</strong>: the founder of the mighty Ethereum java implementation also known as EthereumJ.</li>
</ul>

]]></content>
  </entry>
  
</feed>
